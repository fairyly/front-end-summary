# 千位分割

将普通的数字转换为带千位分隔符格式的数字字符串是一个非常常见的问题，千位分隔符格式的规则是数字的整数部分每三位一组，以“，”分节。小数部分不分节 。
示例：19,351,235.235767

**先分离出小数部分；
对整数部分逆序为数组；**


```
$1、$2、...、$99	与 regexp 中的第 1 到第 99 个子表达式相匹配的文本。
$&	与 regexp 相匹配的子串。
$`	位于匹配子串左侧的文本。
$'	位于匹配子串右侧的文本。
$$	直接量符号。
function format (num) {  
    var reg=/\d{1,3}(?=(\d{3})+$)/g;   
    return (num + '').replace(reg, '$&,');  
}

正则表达式 \d{1,3}(?=(\d{3})+$)  表示前面有1~3个数字，后面的至少由一组3个数字结尾。
?=表示正向引用，可以作为匹配的条件，但匹配到的内容不获取，并且作为下一次查询的开始。
 $& 表示与正则表达式相匹配的内容，具体的使用可以查看字符串replace()方法的
运行的过程看下图
假如有数字13123903243
```

![](http://img.blog.csdn.net/20161003155012112)

1. 非标准$1, $2, $3, $4, $5, $6, $7, $8, $9 属性是包含括号子串匹配的正则表达式的静态和只读属性。该特性是非标准的，请尽量不要在生产环境中使用它！

```
function cc(s){
  if(/[^0-9\.]/.test(s)) return "invalid value";
  s = s.replace(/^(\d*)$/,"$1.");
  s = (s+"00").replace(/(\d*\.\d\d)\d*/,"$1");
  s = s.replace(".",",");
  var re = /(\d)(\d{3},)/;
  while(re.test(s))
    s = s.replace(re,"$1,$2");
    s = s.replace(/,(\d\d)$/,".$1");
    return "￥" + s.replace(/^\./,"0.")
}

cc('34444444')  //"￥34,444,444.00"
```
2.toLocaleString() 方法返回这个数字在特定语言环境下的表示字符串。

```
var a=1234567894532;
var b=673439.4542;

console.log(a.toLocaleString());  // "1,234,567,894,532"
console.log(b.toLocaleString());  // "673,439.454"  （小数部分四舍五入了）

```

3. 实现思路是将数字转换为字符数组，再循环整个数组， 每三位添加一个分隔逗号，最后再合并成字符串。因为分隔符在顺序上是从后往前添加的：比如 1234567添加后是1,234,567 而不是 123,456,7 ，所以方便起见可以先把数组倒序，添加完之后再倒序回来，就是正常的顺序了。要注意的是如果数字带小数的话，要把小数部分分开处理。

```
function numFormat(num){
    num=num.toString().split(".");  // 分隔小数点
    var arr=num[0].split("").reverse();  // 转换成字符数组并且倒序排列
    var res=[];
    for(var i=0,len=arr.length;i<len;i++){
      if(i%3===0&&i!==0){
         res.push(",");   // 添加分隔符
      }
      res.push(arr[i]);
    }
    res.reverse(); // 再次倒序成为正确的顺序
    if(num[1]){  // 如果有小数的话添加小数部分
      res=res.join("").concat("."+num[1]);
    }else{
      res=res.join("");
    }
    return res;
}

var a=1234567894532;
var b=673439.4542;
console.log(numFormat(a)); // "1,234,567,894,532"
console.log(numFormat(b)); // "673,439.4542"

```
